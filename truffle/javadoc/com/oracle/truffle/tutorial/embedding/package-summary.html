<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_141) on Fri Aug 18 09:51:24 PDT 2017 -->
<title>com.oracle.truffle.tutorial.embedding</title>
<meta name="date" content="2017-08-18">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="com.oracle.truffle.tutorial.embedding";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/oracle/truffle/tutorial/background/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../../../com/oracle/truffle/tutorial/graal/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/oracle/truffle/tutorial/embedding/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="Package" class="title">Package&nbsp;com.oracle.truffle.tutorial.embedding</h1>
<div class="docSummary">
<div class="block">Truffle Tutorial: Embedding Truffle Languages in Java</div>
</div>
<p>See:&nbsp;<a href="#package.description">Description</a></p>
</div>
<div class="contentContainer"><a name="package.description">
<!--   -->
</a>
<h2 title="Package com.oracle.truffle.tutorial.embedding Description">Package com.oracle.truffle.tutorial.embedding Description</h2>
<div class="block"><h1>Truffle Tutorial: Embedding Truffle Languages in Java</h1>

 This tutorial shows how to embed the Truffle language
 <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.html" title="class in com.oracle.truffle.api.vm">execution environment</a> in a
 Java application.
 <p>
 The Truffle environment lets Java interoperate with Truffle-implemented
 <em>guest languages</em> via <em>foreign objects</em> and <em>foreign functions</em>.
 For example Java code
 can directly access guest language methods, objects, classes,
 and some complex data structures
 with Java-typed accessors. In the reverse direction, guest language code can access Java objects,
 classes, and constructors.
 <p>
 This tutorial helps you get started, starting with setup instructions, followed by descriptions of
 different interoperation scenarios with (working) code examples.

 <h2>Related information</h2>
 </ul>
 <li><a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine</code></a>: execution environment for Truffle-implemented languages.</li>
 <li><a href="../../../../../com/oracle/truffle/tutorial/package-summary.html">Other Truffle Tutorials</a>
 </ul>


 <h2>Contents</h2>

 <div id="toc"></div>
 <div id="contents">

 <h2>Setup</h2>

 Download
 <a href="http://www.oracle.com/technetwork/oracle-labs/program-languages/overview/">GraalVM</a>,
 which contains all the necessary pre-built components.
 Truffle bits are <a href="http://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22com.oracle.truffle%22%20AND%20a%3A%22truffle-api%22">
 uploaded to Maven central</a>. You can use them from your <em>pom.xml</em>
 file as:
 <pre>
&lt;dependency&gt;
    &lt;groupId&gt;<b>com.oracle.truffle</b>&lt;/groupId&gt;
    &lt;artifactId&gt;<b>truffle-api</b>&lt;/artifactId&gt;
    &lt;version&gt;0.23&lt;/version&gt; <em>&lt;!-- or any later version --&gt;</em>
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;<b>com.oracle.truffle</b>&lt;/groupId&gt;
    &lt;artifactId&gt;<b>truffle-dsl-processor</b>&lt;/artifactId&gt;
    &lt;version&gt;0.23&lt;/version&gt; <em>&lt;!-- same version as above --&gt;</em>
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
 </pre>

 <h2>Get started</h2>

 <h3>Guest language "Hello World!"</h3>

 Integrating Truffle into your Java application starts with building
 an instance of <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine</code></a>, the
 execution environment for Truffle-implemented languages.
 You can then use the engine to
 <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.html#eval-com.oracle.truffle.api.source.Source-"><code>evaluate</code></a>
 guest language source code.
 <p>
 The following example creates the (literal) JavaScript
 <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a> named <code>hello.js</code>,
 evaluates it, and then "casts" the result to a Java string.
 You can also create a <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a> that
 wraps a file name or URL.

 <pre><a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine</code></a> engine = <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine</code></a>.newBuilder().build();
<a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a> helloSource = <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a>.newBuilder(<em>"'Hello World!'"</em>).
    mimeType(<em>"text/javascript"</em>).
    name(<em>"hello.js"</em>).
    build();
<a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine.Value</code></a> result = engine.eval(helloSource);
<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang"><code>String</code></a> resultString = result.as(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang"><code>String</code></a>.<b>class</b>);
<b>assert</b> <em>"Hello World!"</em>.equals(resultString);
</pre>

 <h3>It's a polyglot world</h3>

 How to list all available languages? (TBD)

 <h3>Add a language</h3>

 The set of supported languages is determined by putting their JAR files on a
 classpath of your application. Some languages are available in central
 <a href="http://search.maven.org/#search|ga|1|g%3A%22com.oracle.truffle%22%20AND%20a%3A%22truffle-sl%22">
 Maven repository</a>. To include them, modify your <code>pom.xml</code> file (if
 using Maven) dependency section:

 <pre>
 &lt;dependency&gt;
   &lt;groupId&gt;com.oracle.truffle&lt;/groupId&gt;
   &lt;artifactId&gt;truffle-sl&lt;/artifactId&gt;
   &lt;version&gt;0.23&lt;/version&gt;
 &lt;/dependency&gt;
 </pre>

 In addition to languages found on classpath the
 <a href="http://www.oracle.com/technetwork/oracle-labs/program-languages/overview/">GraalVM</a>
 download comes with highly efficient implementations of <em>JavaScript</em>,
 <a href="https://github.com/graalvm/truffleruby/">Ruby</a> and
 the <a href="https://github.com/graalvm/fastr/">R language</a>.

 <h3>Hello World in Ruby and JavaScript</h3>

 Mixing languages (TBD)

 <h2>Call guest language functions from Java</h2>

 Tuffle interoperation lets Java call
 <em>foreign functions</em> that guest language code <em>exports</em> (details vary across languages).
 This section presents a few examples.

 <h3>Define and call a JavaScript function</h3>

 A function exported from a dynamic language becomes a callable <em>foreign function</em>
 by giving it a Java type, for example the Java interface <code>Multiplier</code> in the following code.

 <pre>&#064;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/FunctionalInterface.html?is-external=true" title="class or interface in java.lang"><code>FunctionalInterface</code></a>
<b>interface</b> Multiplier {
    <b>int</b> multiply(<b>int</b> a, <b>int</b> b);
}

<b>public</b> <b>void</b> callJavaScriptFunctionFromJava() {
    <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a> src = <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a>.newBuilder(
        <em>"(function (a, b) {\n"</em> +
        <em>"  return a * b;"</em> +
        <em>"})"</em>).mimeType(<em>"text/javascript"</em>).name(<em>"mul.js"</em>).build();

    <em>// Evaluate JavaScript function definition</em>
    <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine.Value</code></a> jsFunction = engine.eval(src);

    <em>// Create Java access to JavaScript function</em>
    Multiplier mul = jsFunction.as(Multiplier.<b>class</b>);

    assertEquals(42, mul.multiply(6, 7));
    assertEquals(144, mul.multiply(12, 12));
    assertEquals(256, mul.multiply(32, 8));
}
</pre>

 Notes:
 <ul>
 <li>Evaluating the JS source returns an anonymous JS function of two arguments wrapped
 in a <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>Value</code></a> that can be
 <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html#as-java.lang.Class-">"cast"</a>
 to a <em>foreign function</em> with a Java type.</li>
 <li>Parentheses around the JS function definition keep it out of JavaScript's
 global scope, so the Java object holds the only reference to it.</li>
 </ul>

 <h3>Define and call a Ruby function</h3>

 <pre>&#064;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/FunctionalInterface.html?is-external=true" title="class or interface in java.lang"><code>FunctionalInterface</code></a>
<b>interface</b> Multiplier {
    <b>int</b> multiply(<b>int</b> a, <b>int</b> b);
}

<b>public</b> <b>void</b> callRubyFunctionFromJava() {
    <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a> src = <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a>.newBuilder(
        <em>"proc { |a, b|\n"</em> +
        <em>"  a * b"</em> +
        <em>"}"</em>).mimeType(<em>"application/x-ruby"</em>).name(<em>"mul.rb"</em>).build();

    <em>// Evaluate Ruby function definition</em>
    <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine.Value</code></a> rbFunction = engine.eval(src);

    <em>// Create Java access to Ruby function</em>
    Multiplier mul = rbFunction.as(Multiplier.<b>class</b>);

    assertEquals(42, mul.multiply(6, 7));
    assertEquals(144, mul.multiply(12, 12));
    assertEquals(256, mul.multiply(32, 8));
}
</pre>

 Notes:
 <ul>
 <li>Evaluating the Ruby source returns a Ruby Proc of two arguments wrapped
 in a <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>Value</code></a> that can be
 <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html#as-java.lang.Class-">"cast"</a>
 to a <em>foreign function</em> with a Java type.</li>
 </ul>

 <h3>Call an existing R function</h3>

 In this sample we use a reference to existing R function <code>qbinom</code> from the built-in <em>stats</em> package.

 <pre>&#064;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/FunctionalInterface.html?is-external=true" title="class or interface in java.lang"><code>FunctionalInterface</code></a>
<b>interface</b> BinomQuantile {
    <b>int</b> qbinom(<b>double</b> q, <b>int</b> count, <b>double</b> prob);
}

<b>public</b> <b>void</b> callRFunctionFromJava() {
    <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a> src = <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a>.newBuilder(<em>"qbinom"</em>).
            mimeType(<em>"text/x-r"</em>).name(<em>"qbinom.R"</em>).build();
    BinomQuantile func = engine.eval(src).as(BinomQuantile.<b>class</b>);
    assertEquals(4, func.qbinom(0.37, 10, 0.5));
}
</pre>

 <h2>Call multiple guest language functions with shared state from Java</h2>

 Often it is necessary to export multiple dynamic language functions that work
 together, for example by sharing variables.  This can be done by giving
 an exported group of functions a Java type with more than a single method,
 for example the Java interface <code>Counter</code> in the following code.

 <pre><b>interface</b> Counter {
    <b>void</b> addTime(<b>int</b> hours, <b>int</b> minutes, <b>int</b> seconds);
    <b>int</b> timeInSeconds();
}

<b>public</b> <b>void</b> callJavaScriptFunctionsWithSharedStateFromJava() {
    <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a> src = <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a>.newBuilder(<em>"\n"</em>
        + <em>"(function() {\n"</em>
        + <em>"  var seconds = 0;\n"</em>
        + <em>"  function addTime(h, m, s) {\n"</em>
        + <em>"    seconds += 3600 * h;\n"</em>
        + <em>"    seconds += 60 * m;\n"</em>
        + <em>"    seconds += s;\n"</em>
        + <em>"  }\n"</em>
        + <em>"  function time() {\n"</em>
        + <em>"    return seconds;\n"</em>
        + <em>"  }\n"</em>
        + <em>"  return {\n"</em>
        + <em>"    'addTime': addTime,\n"</em>
        + <em>"    'timeInSeconds': time\n"</em>
        + <em>"  }\n"</em>
        + <em>"})\n"</em>
    ).name(<em>"CountSeconds.js"</em>).mimeType(<em>"text/javascript"</em>).build();

    <em>// Evaluate JavaScript function definition</em>
    <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine.Value</code></a> jsFunction = engine.eval(src);

    <em>// Execute the JavaScript function</em>
    <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine.Value</code></a> jsObject = jsFunction.execute();

    <em>// Create Java access to the JavaScript object</em>
    Counter counter = jsObject.as(Counter.<b>class</b>);

    counter.addTime(6, 30, 0);
    counter.addTime(9, 0, 0);
    counter.addTime(12, 5, 30);

    assertEquals(99330, counter.timeInSeconds());
}
</pre>

 Notes:
 <ul>
 <li>Evaluating the JS source returns an anonymous JS function of no arguments wrapped
 in a <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>Value</code></a> (assigned
 to <code>jsFunction</code>) that can be
 <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html#execute-java.lang.Object...-">executed</a>
 directly, without giving it a Java type.</li>
 <li>Executing <code>jsFunction</code> returns a JS dynamic object (containing two methods
 and a shared variable) wrapped in a <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>Value</code></a>
 that can be <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html#as-java.lang.Class-">"cast"</a>
 to a <em>foreign object</em> with a Java type.</li>
 <li>Parentheses around the JS function definition keep it out of JavaScript's
 global scope, so the Java object holds the only reference to it.</li>
 </ul>

 <h2>Access guest language classes from Java</h2>

 <h3>Access a JavaScript class</h3>

 The ECMAScript 6 specification adds the concept of typeless classes to JavaScript.
 Truffle interoperation allows Java to access fields and functions of a JavaScript class,
 for example the <em>foreign function</em> factory and class given the Java type
 <code>Incrementor</code> in the following code.

 <pre>
<b>interface</b> Incrementor {
    <b>int</b> inc();
    <b>int</b> dec();
    <b>int</b> value();
}

<b>public</b> <b>void</b> callJavaScriptClassFactoryFromJava() {
    <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a> src = <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a>.newBuilder(<em>"\n"</em>
        + <em>"(function() {\n"</em>
        + <em>"  class JSIncrementor {\n"</em>
        + <em>"     constructor(init) {\n"</em>
        + <em>"       this.value = init;\n"</em>
        + <em>"     }\n"</em>
        + <em>"     inc() {\n"</em>
        + <em>"       return ++this.value;\n"</em>
        + <em>"     }\n"</em>
        + <em>"     dec() {\n"</em>
        + <em>"       return --this.value;\n"</em>
        + <em>"     }\n"</em>
        + <em>"  }\n"</em>
        + <em>"  return function(init) {\n"</em>
        + <em>"    return new JSIncrementor(init);\n"</em>
        + <em>"  }\n"</em>
        + <em>"})\n"</em>
    ).name(<em>"Incrementor.js"</em>).mimeType(<em>"text/javascript"</em>).build();

    <em>// Evaluate JavaScript function definition</em>
    <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine.Value</code></a> jsFunction = engine.eval(src);

    <em>// Execute the JavaScript function</em>
    <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine.Value</code></a> jsFactory = jsFunction.execute();

    <em>// Execute the JavaScript factory to create Java objects</em>
    Incrementor initFive = jsFactory.execute(5).as(Incrementor.<b>class</b>);
    Incrementor initTen = jsFactory.execute(10).as(Incrementor.<b>class</b>);

    initFive.inc();
    assertEquals(<em>"Now at seven"</em>, 7, initFive.inc());

    initTen.dec();
    assertEquals(<em>"Now at eight"</em>, 8, initTen.dec());
    initTen.dec();

    assertEquals(<em>"Values are the same"</em>, initFive.value(), initTen.value());
}
</pre>

 Notes:
 <ul>
 <li>Evaluating the JS source returns an anonymous JS function of no arguments wrapped
 in a <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>Value</code></a> (assigned
 to <code>jsFunction</code>) that can be
 <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html#execute-java.lang.Object...-">executed</a>
 directly, without giving it a Java type.</li>
 <li>Executing <code>jsFunction</code> returns a JS factory method for class
 <code>JSIncrementor</code> that can also be executed directly.</li>
 <li>Executing the JS factory returns a JS object
 wrapped in a <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>Value</code></a>
 that can be <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html#as-java.lang.Class-">"cast"</a>
 to a <em>foreign object</em> with the Java type <code>Incrementor</code>.</li>
 <li>Parentheses around the JS function definition keep it out of JavaScript's
 global scope, so the Java object holds the only reference to it.</li>
 </ul>

 <h2>Access guest language data structures from Java</h2>

 The method <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html#as-java.lang.Class-"><code>Value.as(Class)</code></a>
 plays an essential role supporting interoperation between Java and guest language data
 structures.
 This section presents a few examples.

 <h3>Access a JavaScript Array</h3>

 The following example demonstrates type-safe Java foreign access
 to members of a JavaScript array with members of a known type,
 accessed as a Java <a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util"><code>List</code></a> of objects with type given by interface <code>Point</code>.

 <pre>
<b>interface</b> Point {
    <b>int</b> x();
    <b>int</b> y();
}

&#064;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/FunctionalInterface.html?is-external=true" title="class or interface in java.lang"><code>FunctionalInterface</code></a>
<b>interface</b> PointProvider {
    <a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util"><code>List</code></a>&lt;Point&gt; createPoints();
}

<b>public</b> <b>void</b> accessJavaScriptArrayWithTypedElementsFromJava() {
    <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a> src = <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a>.newBuilder(<em>"\n"</em>
        + <em>"(function() {\n"</em>
        + <em>"  class Point {\n"</em>
        + <em>"     constructor(x, y) {\n"</em>
        + <em>"       this.x = x;\n"</em>
        + <em>"       this.y = y;\n"</em>
        + <em>"     }\n"</em>
        + <em>"  }\n"</em>
        + <em>"  return [ new Point(30, 15), new Point(5, 7) ];\n"</em>
        + <em>"})\n"</em>
    ).name(<em>"ArrayOfPoints.js"</em>).mimeType(<em>"text/javascript"</em>).build();

    <em>// Evaluate the JavaScript function definition</em>
    <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine.Value</code></a> jsFunction = engine.eval(src);

    <em>// Create Java-typed access to the JavaScript function</em>
    PointProvider pointProvider = jsFunction.as(PointProvider.<b>class</b>);

    <em>// Invoke the JavaScript function to generate points</em>
    <a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util"><code>List</code></a>&lt;Point&gt; points = pointProvider.createPoints();

    assertEquals(<em>"Two points"</em>, 2, points.size());

    Point first = points.get(0);
    assertEquals(30, first.x());
    assertEquals(15, first.y());

    Point second = points.get(1);
    assertEquals(5, second.x());
    assertEquals(7, second.y());
}
</pre>

 Notes:
 <ul>
 <li>Evaluating the JS source returns an anonymous JS function of no arguments wrapped
 in a <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>Value</code></a> (assigned
 to <code>jsFunction</code>) that can be
 <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html#as-java.lang.Class-">"cast"</a>
 to a <em>foreign function</em> with Java type <code>PointProvider</code>.</li>
 <li>Invoking the foreign function (assigned to <code>pointProvider</code>) creates
 a JS array, which is returned as a <em>foreign object</em>
 with Java type <code>List&lt;Point&gt;</code>.</li>
 <li>Parentheses around the JS function definition keep it out of JavaScript's
 global scope, so the Java object holds the only reference to it.</li>
 </ul>

 <h3>Access a JavaScript JSON structure</h3>

 This example demonstrates type-safe Java foreign access to a JavaScript JSON-like
 structure, based on JSON data returned by a GitHub API.
 The GitHub response contains a list of repository objects. Each repository has an id,
 name, list of URLs, and a nested structure describing its owner. Java interfaces
 <code>Repository</code> and <code>Owner</code> define the structure as Java types.
 <p>
 The following Java code is able to inspect a JavaScript JSON data structure
 generated by "mock parser" in a type-safe way.

 <pre>
<b>interface</b> Repository {
    <b>int</b> id();
    <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang"><code>String</code></a> name();
    Owner owner();
    <b>boolean</b> has_wiki();
    <a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util"><code>List</code></a>&lt;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang"><code>String</code></a>&gt; urls();
}

<b>interface</b> Owner {
    <b>int</b> id();
    <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang"><code>String</code></a> login();
    <b>boolean</b> site_admin();
}

&#064;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/FunctionalInterface.html?is-external=true" title="class or interface in java.lang"><code>FunctionalInterface</code></a>
<b>interface</b> ParseJSON {
    <a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util"><code>List</code></a>&lt;Repository&gt; parse();
}

<b>public</b> <b>void</b> accessJavaScriptJSONObjectFromJava() {
    <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a> src = <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a>.newBuilder(
        <em>"(function () { \n"</em> +
        <em>"  return function() {\n"</em> +
        <em>"    return [\n"</em> +
        <em>"      {\n"</em> +
        <em>"        \"</em>id\<em>": 6109440,\n"</em> +
        <em>"        \"</em>name\<em>": \"</em>holssewebsocket\<em>",\n"</em> +
        <em>"        \"</em>owner\<em>": {\n"</em> +
        <em>"          \"</em>login\<em>": \"</em>jersey\<em>",\n"</em> +
        <em>"          \"</em>id\<em>": 399710,\n"</em> +
        <em>"          \"</em>site_admin\<em>": false\n"</em> +
        <em>"        },\n"</em> +
        <em>"        \"</em>urls\<em>": [\n"</em> +
        <em>"          \"</em>https:<em>//api.github.com/repos/jersey/hol\",\n" +</em>
        <em>"          \"</em>https:<em>//api.github.com/repos/jersey/hol/forks\",\n" +</em>
        <em>"          \"</em>https:<em>//api.github.com/repos/jersey/hol/teams\",\n" +</em>
        <em>"        ],\n"</em> +
        <em>"        \"</em>has_wiki\<em>": true\n"</em> +
        <em>"      }\n"</em> +
        <em>"    ]\n"</em> +
        <em>"  };\n"</em> +
        <em>"})\n"</em>
    ).name(<em>"github-api-value.js"</em>).mimeType(<em>"text/javascript"</em>).build();

    <em>// Evaluate the JavaScript function definition</em>
    <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine.Value</code></a> jsFunction = engine.eval(src);

    <em>// Execute the JavaScript function to create the "mock parser"</em>
    <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine.Value</code></a> jsMockParser = jsFunction.execute();

    <em>// Create Java-typed access to the "mock parser"</em>
    ParseJSON mockParser = jsMockParser.as(ParseJSON.<b>class</b>);

    <a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util"><code>List</code></a>&lt;Repository&gt; repos = mockParser.parse();
    assertEquals(<em>"One repo"</em>, 1, repos.size());
    assertEquals(<em>"holssewebsocket"</em>, repos.get(0).name());
    assertTrue(<em>"wiki"</em>, repos.get(0).has_wiki());
    assertEquals(<em>"3 urls"</em>, 3, repos.get(0).urls().size());
    <b>final</b> <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang"><code>String</code></a> url1 = repos.get(0).urls().get(0);
    assertEquals(<em>"1st"</em>, <em>"https://api.github.com/repos/jersey/hol"</em>, url1);

    Owner owner = repos.get(0).owner();
    assertNotNull(<em>"Owner exists"</em>, owner);

    assertEquals(<em>"login"</em>, <em>"jersey"</em>, owner.login());
    assertEquals(<em>"id"</em>, 399710, owner.id());
    assertFalse(owner.site_admin());
}

</pre>

 Notes:
 <ul>
 <li>Evaluating the JS source returns an anonymous JS function of no arguments wrapped
 in a <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>Value</code></a> (assigned
 to <code>jsFunction</code>) that can be
 <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html#execute-java.lang.Object...-">executed</a>
 directly, without giving it a Java type.</li>
 <li>Executing <code>jsFunction</code> returns a JS mock JSON parser function
 (assigned to <code>jsMockParser</code>) wrapped in a
 <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>Value</code></a>, that can be
 <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html#as-java.lang.Class-">"cast"</a>
 to a <em>foreign function</em> with Java type <code>ParseJSON</code>.</li>
 <li>Calling the Java-typed mock parser creates a JS data structure, which is
 returned as a <em>foreign object</em> with Java type <code>List&lt;Repository&gt;</code>.
 <li>Parentheses around the JS function definition keep it out of JavaScript's
 global scope, so the Java object holds the only reference to it.</li>
 </ul>

 <h2>Access Java from guest languages</h2>

 <h3>Access Java fields and methods from JavaScript</h3>

 <em>Public</em> members of Java objects can be exposed to guest language code
 as <em>foreign objects</em>, for example Java objects of type <code>Moment</code> in
 the following example.

 <pre>
<b>public</b> <b>static</b> <b>final</b> <b>class</b> Moment {
    <b>public</b> <b>final</b> <b>int</b> hours;
    <b>public</b> <b>final</b> <b>int</b> minutes;
    <b>public</b> <b>final</b> <b>int</b> seconds;

    <b>public</b> Moment(<b>int</b> hours, <b>int</b> minutes, <b>int</b> seconds) {
        <b>this</b>.hours = hours;
        <b>this</b>.minutes = minutes;
        <b>this</b>.seconds = seconds;
    }
}

<b>public</b> <b>void</b> accessFieldsOfJavaObject() {
    <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a> src = <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a>.newBuilder(<em>"\n"</em>
        + <em>"(function(t) {\n"</em>
        + <em>"  return 3600 * t.hours + 60 * t.minutes + t.seconds;\n"</em>
        + <em>"})\n"</em>
    ).name(<em>"MomentToSeconds.js"</em>).mimeType(<em>"text/javascript"</em>).build();

    <b>final</b> Moment javaMoment = <b>new</b> Moment(6, 30, 10);

    <em>// Evaluate the JavaScript function definition</em>
    <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine.Value</code></a> jsFunction = engine.eval(src);

    <em>// Execute the JavaScript function, passing a Java object argument</em>
    <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine.Value</code></a> jsSeconds = jsFunction.execute(javaMoment);

    <em>// Convert foreign object result to desired Java type</em>
    <b>int</b> seconds = jsSeconds.as(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Number.html?is-external=true" title="class or interface in java.lang"><code>Number</code></a>.<b>class</b>).intValue();

    assertEquals(3600 * 6 + 30 * 60 + 10, seconds);
}
</pre>

 Notes:
 <ul>
 <li>Evaluating the JS source returns an anonymous JS function of one argument wrapped
 in a <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>Value</code></a> (assigned to
 <code>jsFunction</code>) that can be executed directly with one argument.</li>
 <li>The Java argument <code>javaMoment</code> is seen by the JS function as a
 <em>foreign object</em> whose public fields are visible.</em>
 <li>Executing <code>jsFunction</code> returns a JS number
 that can be
 <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html#as-java.lang.Class-">"cast"</a>
 to a Java <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Number.html?is-external=true" title="class or interface in java.lang"><code>Number</code></a> and then to a Java <code>int</code>.</li>
 <li>Parentheses around the JS function definition keep it out of JavaScript's
 global scope, so the Java object holds the only reference to it.</li>
 </ul>

 The multiple steps needed to convert the result in the above example
 produces awkward code that can be simplified.
 Instead of invoking the JS function directly, and "casting" the wrapped JS result,
 we can instead
 <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html#as-java.lang.Class-">"cast"</a>
 the JS function to a Java foreign function (of type <code>MomentConverter</code>) that
 returns the desired Java type directly, as shown in the following variation.

 <pre>
&#064;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/FunctionalInterface.html?is-external=true" title="class or interface in java.lang"><code>FunctionalInterface</code></a>
<b>interface</b> MomentConverter {
    <b>int</b> toSeconds(Moment moment);
}

<b>public</b> <b>void</b> accessFieldsOfJavaObjectWithConverter() {
    <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a> src = <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a>.newBuilder(<em>"\n"</em>
        + <em>"(function(t) {\n"</em>
        + <em>"  return 3600 * t.hours + 60 * t.minutes + t.seconds;\n"</em>
        + <em>"})\n"</em>
    ).name(<em>"MomentToSeconds.js"</em>).mimeType(<em>"text/javascript"</em>).build();

    <b>final</b> Moment javaMoment = <b>new</b> Moment(6, 30, 10);

    <em>// Evaluate the JavaScript function definition</em>
    <b>final</b> <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine.Value</code></a> jsFunction = engine.eval(src);

    <em>// Convert the function to desired Java type</em>
    MomentConverter converter = jsFunction.as(MomentConverter.<b>class</b>);

    <em>// Execute the JavaScript function as a Java foreign function</em>
    <b>int</b> seconds = converter.toSeconds(javaMoment);

    assertEquals(3600 * 6 + 30 * 60 + 10, seconds);
}
</pre>

 <h3>Access Java constructors and static methods from JavaScript</h3>

 Dynamic languages can also access the <em>public constructors</em> and <em>public static methods</em>
 of any Java class for which they are provided a reference.
 The following example shows JavaScript access to the public constructor of a Java
 class.

 <pre>
<b>interface</b> MomentFactory {
    Moment create(<b>int</b> h, <b>int</b> m, <b>int</b> s);
}

<b>public</b> <b>void</b> createJavaScriptFactoryForJavaClass() {
    <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a> src = <a href="../../../../../com/oracle/truffle/api/source/Source.html" title="class in com.oracle.truffle.api.source"><code>Source</code></a>.newBuilder(<em>"\n"</em>
        + <em>"(function(Moment) {\n"</em>
        + <em>"  return function(h, m, s) {\n"</em>
        + <em>"     return new Moment(h, m, s);\n"</em>
        + <em>"  };\n"</em>
        + <em>"})\n"</em>
    ).name(<em>"ConstructMoment.js"</em>).mimeType(<em>"text/javascript"</em>).build();

    <em>// Evaluate the JavaScript function definition</em>
    <b>final</b> <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine.Value</code></a> jsFunction = engine.eval(src);

    <em>// Create a JavaScript factory for the provided Java class</em>
    <b>final</b> <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>PolyglotEngine.Value</code></a> jsFactory = jsFunction.execute(Moment.<b>class</b>);

    <em>// Convert the JavaScript factory to a Java foreign function</em>
    MomentFactory momentFactory = jsFactory.as(MomentFactory.<b>class</b>);

    <b>final</b> Moment javaMoment = momentFactory.create(6, 30, 10);
    assertEquals(<em>"Hours"</em>, 6, javaMoment.hours);
    assertEquals(<em>"Minutes"</em>, 30, javaMoment.minutes);
    assertEquals(<em>"Seconds"</em>, 10, javaMoment.seconds);
}
</pre>

 Notes:
 <ul>
 <li>Evaluating the JS source returns an anonymous JS function of one argument wrapped
 in a <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html" title="class in com.oracle.truffle.api.vm"><code>Value</code></a> (assigned to
 <code>jsFunction</code>) that can be executed directly with one argument.</li>
 <li>The Java class argument <code>Moment.class</code> is seen by the JS function as a
 <em>foreign class</em> whose public constructor is visible.</em>
 <li>Executing <code>jsFunction</code> with the Java class argument returns
 a JS "factory" function (for the Java class) that can be
 <a href="../../../../../com/oracle/truffle/api/vm/PolyglotEngine.Value.html#as-java.lang.Class-">"cast"</a>
 to the desired Java function type (<code>MomentFactory</code>).</li>
 <li>Parentheses around the JS function definition keep it out of JavaScript's
 global scope, so the Java object holds the only reference to it.</li>
 </ul>

 </div>
 <script src="../doc-files/tutorial.js"></script></div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>0.25</dd>
</dl>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/oracle/truffle/tutorial/background/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../../../com/oracle/truffle/tutorial/graal/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/oracle/truffle/tutorial/embedding/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
